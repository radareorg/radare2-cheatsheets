\documentclass[10pt]{article}
\usepackage{r2style}

%----------------------------------------------------------------------

\title{r2frida Cheatsheet}
\begin{document}
\pagestyle{r2fancy}

\begin{center}
	\Large{\bf r2frida Cheatsheet}
	\rule{\textwidth}{0.2pt}
\end{center}

\begin{multicols}{3}
\noindent
r2frida is an IO plugin, commands start with `{\ttc:}'
\begin{center}
\ttc{r2 frida://action/link/device//target} %XXX //target or /target?
\end{center}
where:
\begin{itemize}
	\itemsep 0em % Set the space between items
	\item action = list $\vert$ apps $\vert$ attach $\vert$ spawn $\vert$ launch
	\item link   = local $\vert$ usb $\vert$ remote host:port
	\item device = {\tt \textquotesingle \textquotesingle} $\vert$ host:port $\vert$ device-id
	\item target = pid $\vert$ app $\vert$ process $\vert$ program $\vert$ abspath
\end{itemize}

\subsection*{Target Addresses}
\noindent
Commands accepting an [addr] follow this pattern:
\begin{itemize}
	\itemsep 0em % Set the space between items
	\item 0xabcd = absolute address in hexadecimal
	\item symname = symbol name from module exports
	\item objc:class = Objective C
	\item java:class = Java class + method
\end{itemize}

\subsection*{Trace Format}
\noindent
The :dtf command create trace hooks from a simple format-string. See \ttc{:dtf?}
\begin{itemize}
	\itemsep 0em % Set the space between items
	\item \^{} = trace onEnter instead of onExit
	\item \%{} = also trace the return value (onLeave)
	\item + = show backtrace when trace is hit
	\item s = string in place (w=wide, a=ansi)
	\item S = pointer to string (Z=nullable string)
	\item O = object reference (valid for java and objc)
	\item x = hexadecimal value (i=decimal)
	\item h = hexdump from pointer (H for ptr+length)
\end{itemize}

\subsection*{Basic Commands}
\cmd{:e}{get and edit r2frida options}
\cmd{:i}{get arch/bits from target ({\tt .i*} to load into r2)}
\cmd{:ih}{parse binary headers of the current module}
\cmd{:ii$[$*$]$}{list imports}
\cmd{:il}{list libraries}
\cmd{:is$[$*$]$ $<$lib$>$}{list local and global symbols of {\em lib}}
\cmd{:isa$[$*$]$ ($<$lib$>$) $<$sym$>$}{show addres of {\em sym}} % XXX: [<lib>] ?
\cmd{:ie}{show entrypoint}
\cmd{:iE$[$*$]$ $<$lib$>$}{same as \ttc{is}, for exported globals}
\cmd{:ic $<$class$>$}{list Objective-C classes or methods}
\cmd{:icn $<$name$>$}{list native methods from Java classes}
\cmd{:icw}{locate ObjC classes implementations (where)}
\cmd{:ip $<$protocol$>$}{list ObjC protocols/methods}
\cmd{:fd$[$*j$]$ $<$addr$>$}{inverse symbol resolution}

\subsection*{Tracing}
\begin{flushright}
\cmd{:dtr $<$addr$>$ $<$regs$>$}{trace given registers at {\em addr}}
\cmd{:dtf $<$addr$>$ $[$fmt$]$}{trace address with format \ttc{\^{}ixz0} (see \ttc{dtf?})}
\cmd{:dt ($<$addr$>$|$<$sym$>$)}{trace addresses or symbols}
\cmd{:dtl$[$-*$]$ $[$msg$]$}{debug trace log, useful to \ttc{.\textbackslash T*}}
\cmd{:dt.}{trace at current offset}
\cmd{:dm$[$.|j|*$]$}{show memory regions}
\cmd{:dmm$[$.|j|*$]$}{show memory range (grouped maps)}
\cmd{:dt-$[$*$]$}{clear all tracing}
\end{flushright}

\subsection*{Debugging}
\cmd{:db ($<$addr$>$|$<$sym$>$)}{list or place breakpoint}
\cmd{:db- ($<$addr$>$|$<$sym$>$|*)}{remove breakpoint(s)}
\cmd{:dc}{continue after breakpoint or resume execution}
\cmd{:dk}{send signal}
\cmd{:dkr}{show the crashdump}
\cmd{:d.}{start the chrome tools debugger}
\cmd{:dl $<$path$>$}{{\tt dlopen}}
\cmd{:dr}{show register values}

\subsection*{Injecting}
\cmd{:dxc $[target]$ $[$args$]$}{call target symbol with args}
\cmd{:dxo $[$sym$]$ $[$args$]$}{call an ObjC function with args}
\cmd{:di$[$0,1,-1$]$ $[$addr$]$}{replace function to return value}
\cmd{:dii $[$addr$]$ $[$num$]$}{replace function to return num}
\cmd{:dis $[$addr$]$}{replace to return a string}
\cmd{:div}{replace with another function returning null}
\cmd{:dif$[$0,1,-1$]$ $[$addr$]$}{replace the return value}
\cmd{:difi $[$addr$]$ $[$num$]$}{replace return number}
\cmd{:difs}{replace return with given string}
\cmd{:dir}{revert a trace at the given function} % XXX: dir <fun>?
\cmd{:dd}{list file descriptors}
\cmd{:dl $<$lib$>$}{{\tt dlopen} the given library}
\cmd{:dlf $[$path$]$}{load a framework (ObjC only)}
\cmd{:dl2 $<$lib$>$ $[$main$]$}{inject a library}
\cmd{:. $<$script.js$>$}{run script}
\cmd{:eval $<$code.js$>$}{evaluate script in the agent}

\subsection*{Searching}
\cmd{:/$[$x$]$$[$j$]$ $<$pattern$>$}{find hex/str in \ttc{search.in=?}}
\cmd{:/w$[$j$]$ $<$string$>$}{search wide string}
\cmd{:/v$[$1248$]$$[$j$]$ $<$value$>$}{find \ttc{e cfg.bigendian} value}
\cmd{:env $[$k$[$=v$]$$]$}{get/set environment variable}
\cmd{:e$[$?$]$ $[$a$[$=b$]$$]$}{list/get/set config evaluable variables}

\end{multicols}
\end{document}
